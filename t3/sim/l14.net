*
* NGSPICE simulation script
*
*

* forces current values to be saved
.options savecurrents

* supply voltage AC
Vs 1 GND SIN(0 230 50 0 0 0)

*Dependent Voltage source
E1 2 GND 1 GND 0.1

Rq 1 GND 1
* ideal transformer (10:1 =>   L1/L2 = (N1/N2)^2  )
*L1 1 GND 2000
*L2 2 GND 20
*K L1 L2 0.99999

** envelop detector
* diode
D1 4 2 Default
D2 2 3 Default
D3 4 GND Default
D4 GND 3 Default
.model Default D
*resistor
R1 4 3 10k
*capacitor
Cc 4 3 10uF




.op

.end

.control

*makes plots in color
set hcopypscolor=0
set color0=white
set color1=black
set color2=red
set color3=blue
set color4=violet
set color5=rgb:3/8/0
set color6=rgb:4/0/0

*op

*echo "********************************************"
*echo  "Operating point"
*echo "********************************************"
*print Vcc
*print @Q1[ic]
*print @Rf[i]

*echo  "op_TAB"
*print all
*echo  "op_END"


echo "********************************************"
echo  "Transient analysis"
echo "********************************************"
tran 10e-5 0.2

hardcopy trans2.ps  v(3)
echo trans_FIG

*echo "********************************************"
*echo  "Frequency analysis"
*echo "********************************************"

*ac dec 10 10 100MEG

*hardcopy acm.ps db(v(coll)) v(base)
*echo acm_FIG
*hardcopy acp.ps v(base)
*echo acp_FIG

*plot db(v(coll))
*plot vp(coll)

*echo "********************************************"
*echo  "Input impedance"
*echo "********************************************"

*hardcopy zim.ps abs(v(coll)/((v(1)-v(2))/1k))
*echo zim_FIG

.endc
