*
* NGSPICE simulation script
*
*

* forces current values to be saved
.options savecurrents

* supply voltage AC
Vs 1 GND SIN(0 230 50 0 0 0)

*Dependent Voltage source as transformer
E1 2 GND 1 GND 1k

Rq 1 GND 1k

*voltage regulator
R2 2 3 10e-12
D1 3 4 Default
D2 4 5 Default
D3 5 6 Default
D4 6 7 Default
D5 7 8 Default
D6 8 9 Default
D7 9 GND Default



** envelop detector
* diode
D100 3 10 Default

.model Default D
*resistor
R1 10 GND 30T0k
*capacitor
Cc 10 GND 10uF



.op
.measure tran yavg AVG v(10) from=0 to=0.2
.measure tran ymax MAX v(10) from=0 to=0.2
.measure tran ymin MIN v(10) from=0.05 to=0.2
.end


.control

*makes plots in color
set hcopypscolor=0
set color0=white
set color1=black
set color2=red
set color3=blue
set color4=violet
set color5=rgb:3/8/0
set color6=rgb:4/0/0

*op

*echo "********************************************"
*echo  "Operating point"
*echo "********************************************"
*print Vcc
*print @Q1[ic]
*print @Rf[i]

*echo  "op_TAB"
*print all
*echo  "op_END"


echo "********************************************"
echo  "Transient analysis"
echo "********************************************"
tran 10e-7 0.2
hardcopy trans.ps  v(10) avg(v(10))
echo trans_FIG

*echo "********************************************"
*echo  "Frequency analysis"
*echo "********************************************"

*ac dec 10 10 100MEG

*hardcopy acm.ps db(v(coll)) v(base)
*echo acm_FIG
*hardcopy acp.ps v(base)
*echo acp_FIG

*plot db(v(coll))
*plot vp(coll)

*echo "********************************************"
*echo  "Input impedance"
*echo "********************************************"

*hardcopy zim.ps abs(v(coll)/((v(1)-v(2))/1k))
*echo zim_FIG

.endc
